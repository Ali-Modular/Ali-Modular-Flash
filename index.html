<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ali Modular — Firmware Updater</title>
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#ea4a34">
  <style>
    :root{
      --brand:#ea4a34;
      --brand-ink:#ffffff;
      --bg:#0a0b0d; --bg-soft:#0e1117;
      --fg:#e7edf3; --muted:#aab6c3;
      --line:#1b2330; --card:#11161f;
      --ok:#33d17a; --warn:#f5c451; --err:#ff6b6b;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(180deg,#0a0b0d 0%, #0b0e13 60%, #0d1016 100%);color:var(--fg);
      font:16px/1.45 system-ui,-apple-system,"Segoe UI",Inter,Roboto,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;padding:16px 0}
    .logo{display:flex;align-items:center;gap:14px}
    .logo img{height:42px;width:auto;display:block}
    .logo h1{font-size:1.35rem;margin:0;letter-spacing:.2px}
    nav a{margin-left:18px;opacity:.9}
    nav a:hover{opacity:1}
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:22px;align-items:center;margin-top:8px}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .hero-card{padding:28px}
    .badge{display:inline-flex;align-items:center;gap:8px;background:rgba(234,74,52,.12);border:1px solid rgba(234,74,52,.4);
      color:var(--brand);padding:6px 10px;border-radius:999px;font-size:.85rem;margin-bottom:12px}
    .hero h2{font-size:1.9rem;margin:.2rem 0 .6rem 0}
    .hero p{margin:.3rem 0 1rem 0;color:var(--muted)}
    .cta-row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .btn{appearance:none;border:1px solid var(--line);background:var(--brand);color:var(--brand-ink);
      padding:.8rem 1.1rem;border-radius:12px;font-weight:600;cursor:pointer;transition:.15s}
    .btn:hover{transform:translateY(-1px);filter:saturate(1.05)}
    .btn.ghost{background:transparent;color:var(--fg)}
    .env{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px dashed var(--line);background:rgba(255,255,255,.02)}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:22px;margin-top:22px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    h3{margin:.2rem 0 1rem 0;font-size:1.15rem}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    label{font-size:.95rem;color:var(--muted)}
    select,input[type="file"]{background:#0f141c;border:1px solid var(--line);color:var(--fg);
      padding:.55rem .7rem;border-radius:10px}
    details{background:#0f141c;border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px}
    details summary{cursor:pointer;font-weight:600}
    ul.notes{margin:.5rem 0 0 0;padding-left:18px}
    .console{padding:0}
    .console h3{padding:18px 18px 0 18px}
    pre#log{margin:12px;border-top:1px solid var(--line);padding:14px 18px;height:320px;overflow:auto;
      background:var(--bg-soft);border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}
    footer{margin:26px 0;color:var(--muted);font-size:.9rem;text-align:center}
    @media (max-width:980px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <img src="./assets/Ali-Modular_Color-Alt-Transparent.png" alt="Ali Modular logo" />
        <h1>Ali Modular — Firmware Updater</h1>
      </div>
      <nav>
        <a href="https://alimodular.com" target="_blank" rel="noopener">alimodular.com</a>
      </nav>
    </header>

    <section class="hero">
      <div class="panel hero-card">
        <span class="badge">DFU (Daisy Seed) via WebUSB</span>
        <h2>Update your Esu’s Trifecta firmware</h2>
        <p>Use Chrome or Edge on desktop over HTTPS. Put the module in <b>DFU</b>: hold <b>BOOT</b>, press <b>RESET</b>, release RESET, then release BOOT.</p>
        <div class="cta-row">
          <button id="connectBtn" class="btn">Connect Device</button>
          <button id="refreshBtn" class="btn ghost">Refresh Versions</button>
          <span id="deviceInfo" class="muted"></span>
        </div>
        <div id="env" class="env"></div>
      </div>

      <div class="panel hero-card">
        <h3>Firmware</h3>
        <div class="row">
          <label for="channel">Channel</label>
          <select id="channel"></select>
          <label for="version">Version</label>
          <select id="version"></select>
        </div>
        <details open>
          <summary>Release notes</summary>
          <ul id="notes" class="notes"></ul>
        </details>
        <div class="row" style="margin-top:12px">
          <button id="flashBtn" class="btn" disabled>Flash Selected</button>
          <span id="progressText" class="muted"></span>
        </div>
        <hr style="border:none;border-top:1px solid var(--line);margin:14px 0">
        <h3>Manual file</h3>
        <p class="muted">Have a <code>.bin</code>? Flash it directly.</p>
        <div class="row">
          <input id="fileInput" type="file" accept=".bin,application/octet-stream" />
          <button id="flashFileBtn" class="btn" disabled>Flash File</button>
        </div>
      </div>
    </section>

    <section class="grid">
      <div class="card console">
        <h3>Console</h3>
        <pre id="log"></pre>
      </div>
    </section>

    <footer>© 2025 Ali Modular · Flashing happens locally in your browser with WebUSB DFU.</footer>
  </div>

  <script src="https://unpkg.com/webdfu@0.1.7/dist/webdfu.min.js" defer></script>
  <script>
  // same JS logic (connect, manifest, flash) as before
  </script>
</body>
</html>
